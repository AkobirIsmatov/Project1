eval(atob('Y29uc3Qgc2tpbGxJY29ucyA9IHsKICBQeXRob246ICdmYS1icmFuZHMgZmEtcHl0aG9uJywKICBCYXNoOiAnZmEtc29saWQgZmEtdGVybWluYWwnLAogIEF1dG9tYXRpb246ICdmYS1zb2xpZCBmYS1yb2JvdCcsCiAgU2NyaXB0aW5nOiAnZmEtc29saWQgZmEtY29kZScsCiAgU0lFTTogJ2ZhLXNvbGlkIGZhLWV5ZScsCiAgUk1NOiAnZmEtc29saWQgZmEtc2NyZXdkcml2ZXItd3JlbmNoJywKICAnSURTL0lQUyc6ICdmYS1zb2xpZCBmYS1zaGllbGQtaGFsdmVkJywKICAnRURSL1hEUic6ICdmYS1zb2xpZCBmYS1zaGllbGQtaGFsdmVkJywKICAnQ29tcHV0ZXIgVmlzaW9uJzogJ2ZhLXNvbGlkIGZhLWV5ZScsCiAgJ1ImRCc6ICdmYS1zb2xpZCBmYS1mbGFzaycsCiAgJ0FydGlmaWNpYWwgSW50ZWxsaWdlbmNlJzogJ2ZhLXNvbGlkIGZhLWJyYWluJywKICBMTE1zOiAnZmEtc29saWQgZmEtYnJhaW4nLAogICdEZWVwIExlYXJuaW5nJzogJ2ZhLXNvbGlkIGZhLWxheWVyLWdyb3VwJywKICAnTWFjaGluZSBMZWFybmluZyc6ICdmYS1zb2xpZCBmYS1nZWFycycsCiAgJ05ldHdvcmsgU2VjdXJpdHknOiAnZmEtc29saWQgZmEtbmV0d29yay13aXJlZCcsCiAgQ3liZXJzZWN1cml0eTogJ2ZhLXNvbGlkIGZhLXVzZXItc2hpZWxkJywKICAnRGF0YSBBbmFseXRpY3MnOiAnZmEtc29saWQgZmEtY2hhcnQtbGluZScsCiAgQmxvY2tjaGFpbjogJ2ZhLWJyYW5kcyBmYS1iaXRjb2luJywKICBDcnlwdG86ICdmYS1zb2xpZCBmYS1jb2lucycKfTsKCmNvbnN0IHJvbGVJY29ucyA9IHsKICAnQ3liZXJzZWN1cml0eSBTcGVjaWFsaXN0JzogJ2ZhLXNvbGlkIGZhLXVzZXItc2hpZWxkJywKICAnU2VuaW9yIFNvZnR3YXJlIEVuZ2luZWVyJzogJ2ZhLXNvbGlkIGZhLWNvZGUnLAogICdOZXR3b3JrIGFuZCBTZWN1cml0eSBSZXNlYXJjaGVyJzogJ2ZhLXNvbGlkIGZhLWZsYXNrJywKICAnRm9yZW5zaWNzIEFuYWx5c3QnOiAnZmEtc29saWQgZmEtbWFnbmlmeWluZy1nbGFzcycsCiAgJ0xhYiBBc3Npc3RhbnQnOiAnZmEtc29saWQgZmEtdmlhbHMnCn07Cgpjb25zdCB0cmFja1ByZXZpb3VzID0gKGVsKSA9PiB7CiAgY29uc3QgcmFkaW9zID0gZWwucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0icmFkaW8iXScpOwogIGxldCBwcmV2aW91c1ZhbHVlID0gbnVsbDsKCiAgY29uc3QgaW5pdGlhbGx5Q2hlY2tlZCA9IGVsLnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W3R5cGU9InJhZGlvIl06Y2hlY2tlZCcpOwogIGlmIChpbml0aWFsbHlDaGVja2VkKSB7CiAgICBwcmV2aW91c1ZhbHVlID0gaW5pdGlhbGx5Q2hlY2tlZC5nZXRBdHRyaWJ1dGUoJ2Mtb3B0aW9uJyk7CiAgICBlbC5zZXRBdHRyaWJ1dGUoJ2MtcHJldmlvdXMnLCBwcmV2aW91c1ZhbHVlKTsKICB9CgogIHJhZGlvcy5mb3JFYWNoKHJhZGlvID0+IHsKICAgIHJhZGlvLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpID0+IHsKICAgICAgaWYgKHJhZGlvLmNoZWNrZWQpIHsKICAgICAgICBlbC5zZXRBdHRyaWJ1dGUoJ2MtcHJldmlvdXMnLCBwcmV2aW91c1ZhbHVlID8/ICcnKTsKICAgICAgICBwcmV2aW91c1ZhbHVlID0gcmFkaW8uZ2V0QXR0cmlidXRlKCdjLW9wdGlvbicpOwogICAgICB9CiAgICB9KTsKICB9KTsKfTsKCmNvbnN0IHByb2ZpbGVJY29ucyA9IHsKICBHaXRIdWI6ICdmYS1icmFuZHMgZmEtZ2l0aHViJywKICBMaW5rZWRJbjogJ2ZhLWJyYW5kcyBmYS1saW5rZWRpbicsCiAgVHJ5SGFja01lOiAnZmEtc29saWQgZmEtdXNlci1zZWNyZXQnCn07CgpmdW5jdGlvbiBnZXRTa2lsbEljb24oc2tpbGwpIHsKICByZXR1cm4gc2tpbGxJY29uc1tza2lsbF0gfHwgJ2ZhLXNvbGlkIGZhLWNpcmNsZSc7Cn0KCmZ1bmN0aW9uIGdldFJvbGVJY29uKHRpdGxlKSB7CiAgZm9yIChjb25zdCBba2V5LCBpY29uXSBvZiBPYmplY3QuZW50cmllcyhyb2xlSWNvbnMpKSB7CiAgICBpZiAodGl0bGUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhrZXkudG9Mb3dlckNhc2UoKSkpIHsKICAgICAgcmV0dXJuIGljb247CiAgICB9CiAgfQogIHJldHVybiAnZmEtc29saWQgZmEtYnJpZWZjYXNlJzsKfQoKZnVuY3Rpb24gc2FuaXRpemVVcmwodXJsKSB7CiAgaWYgKHR5cGVvZiB1cmwgIT09ICdzdHJpbmcnKSByZXR1cm4gJyc7CiAgY29uc3QgdHJpbW1lZCA9IHVybC50cmltKCk7CiAgaWYgKC9eaHR0cHM/OlwvXC8vaS50ZXN0KHRyaW1tZWQpKSB7CiAgICB0cnkgewogICAgICByZXR1cm4gZW5jb2RlVVJJKHRyaW1tZWQpOwogICAgfSBjYXRjaCB7CiAgICAgIHJldHVybiAnJzsKICAgIH0KICB9CiAgcmV0dXJuICcnOwp9CgpmdW5jdGlvbiBzYW5pdGl6ZUVtYWlsKGVtYWlsKSB7CiAgaWYgKHR5cGVvZiBlbWFpbCAhPT0gJ3N0cmluZycpIHJldHVybiAnJzsKICBjb25zdCB0cmltbWVkID0gZW1haWwudHJpbSgpOwogIGNvbnN0IGVtYWlsUGF0dGVybiA9IC9eW15cc0BdK0BbXlxzQF0rXC5bXlxzQF0rJC87CiAgcmV0dXJuIGVtYWlsUGF0dGVybi50ZXN0KHRyaW1tZWQpID8gdHJpbW1lZCA6ICcnOwp9CgpmdW5jdGlvbiBzYW5pdGl6ZVBob25lKHBob25lKSB7CiAgaWYgKHR5cGVvZiBwaG9uZSAhPT0gJ3N0cmluZycpIHJldHVybiAnJzsKICByZXR1cm4gcGhvbmUucmVwbGFjZSgvW14rXGRdL2csICcnKTsKfQoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICBjb25zdCBzd2l0Y2hlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5zd2l0Y2hlcicpOwogIGlmIChzd2l0Y2hlcikgewogICAgY29uc3QgcmFkaW9zID0gc3dpdGNoZXIucXVlcnlTZWxlY3RvckFsbCgnaW5wdXRbdHlwZT0icmFkaW8iXScpOwogICAgY29uc3Qgc3RvcmVkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3RoZW1lJykgfHwgJ2RhcmsnOwogICAgY29uc3QgYWN0aXZlID0gc3dpdGNoZXIucXVlcnlTZWxlY3RvcihgaW5wdXRbdmFsdWU9IiR7c3RvcmVkfSJdYCk7CiAgICBpZiAoYWN0aXZlKSBhY3RpdmUuY2hlY2tlZCA9IHRydWU7CiAgICBpZiAoIWxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0aGVtZScpKSB7CiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0aGVtZScsICdkYXJrJyk7CiAgICB9CiAgICB0cmFja1ByZXZpb3VzKHN3aXRjaGVyKTsKICAgIHJhZGlvcy5mb3JFYWNoKHJhZGlvID0+IHsKICAgICAgcmFkaW8uYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKCkgPT4gewogICAgICAgIGlmIChyYWRpby5jaGVja2VkKSB7CiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgndGhlbWUnLCByYWRpby52YWx1ZSk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0pOwogIH0KCiAgY29uc3QgeWVhclNwYW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VycmVudC15ZWFyJyk7CiAgaWYgKHllYXJTcGFuKSB7CiAgICB5ZWFyU3Bhbi50ZXh0Q29udGVudCA9IG5ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKTsKICB9CgogICAgZmV0Y2goJ0NWX2luZm8uanNvbicpCiAgICAgIC50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKCFyZXMub2spIHsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGZldGNoIENWX2luZm8uanNvbjogJHtyZXMuc3RhdHVzfWApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzLmpzb24oKTsKICAgICAgfSkKICAgICAgLnRoZW4oZGF0YSA9PiBwb3B1bGF0ZShkYXRhKSkKICAgICAgLmNhdGNoKGVyciA9PiB7CiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgbG9hZGluZyBDVl9pbmZvLmpzb246JywgZXJyKTsKICAgICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbi1jb250ZW50Jyk7CiAgICAgICAgaWYgKGNvbnRhaW5lcikgewogICAgICAgICAgY29uc3QgbXNnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpOwogICAgICAgICAgbXNnLnRleHRDb250ZW50ID0gJ1VuYWJsZSB0byBsb2FkIENWIGluZm9ybWF0aW9uLic7CiAgICAgICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobXNnKTsKICAgICAgICB9CiAgICAgIH0pOwoKICAgIGNvbnN0IGNvbnRhY3RUb2dnbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29udGFjdC10b2dnbGUnKTsKICAgIGNvbnN0IGNvbnRhY3RDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhY3QtY29udGVudCcpOwogICAgaWYgKGNvbnRhY3RUb2dnbGUgJiYgY29udGFjdENvbnRlbnQpIHsKICAgICAgY29udGFjdFRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICBjb25zdCBpc09wZW4gPSBjb250YWN0Q29udGVudC5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJyk7CiAgICAgICAgY29udGFjdFRvZ2dsZS5jbGFzc0xpc3QudG9nZ2xlKCdvcGVuJywgaXNPcGVuKTsKICAgICAgICBjb250YWN0VG9nZ2xlLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIGlzT3Blbik7CiAgICAgICAgY29udGFjdENvbnRlbnQuc3R5bGUubWF4SGVpZ2h0ID0gaXNPcGVuID8gY29udGFjdENvbnRlbnQuc2Nyb2xsSGVpZ2h0ICsgJ3B4JyA6IDA7CiAgICAgIH0pOwogICAgfQoKICAgIGNvbnN0IHNlY3Rpb25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlY3Rpb24nKTsKICBzZWN0aW9ucy5mb3JFYWNoKHNlYyA9PiBzZWMuY2xhc3NMaXN0LmFkZCgnaGlkZGVuJykpOwogIGNvbnN0IG9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKGVudHJpZXMgPT4gewogICAgZW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHsKICAgICAgaWYgKGVudHJ5LmlzSW50ZXJzZWN0aW5nKSB7CiAgICAgICAgZW50cnkudGFyZ2V0LmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgICAgICBlbnRyeS50YXJnZXQuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgIH0KICAgIH0pOwogIH0sIHsgdGhyZXNob2xkOiAwLjEgfSk7CiAgc2VjdGlvbnMuZm9yRWFjaChzZWN0aW9uID0+IG9ic2VydmVyLm9ic2VydmUoc2VjdGlvbikpOwoKICBjb25zdCBuYXZMaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5uYXYtbGlua3MgYScpOwogIGNvbnN0IG5hdlRvZ2dsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYXYtdG9nZ2xlJyk7CiAgY29uc3QgbmF2TGlua3NDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmF2LWxpbmtzJyk7CiAgbmF2VG9nZ2xlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgY29uc3QgaXNPcGVuID0gbmF2TGlua3NDb250YWluZXIuY2xhc3NMaXN0LnRvZ2dsZSgnc2hvdycpOwogICAgbmF2VG9nZ2xlLnNldEF0dHJpYnV0ZSgnYXJpYS1leHBhbmRlZCcsIGlzT3Blbik7CiAgfSk7CiAgbmF2TGlua3MuZm9yRWFjaChsaW5rID0+CiAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICBuYXZMaW5rc0NvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICAgIG5hdlRvZ2dsZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtZXhwYW5kZWQnLCAnZmFsc2UnKTsKICAgIH0pCiAgKTsKCiAgY29uc3Qgc2VjdGlvbk9ic2VydmVyID0gbmV3IEludGVyc2VjdGlvbk9ic2VydmVyKGVudHJpZXMgPT4gewogICAgZW50cmllcy5mb3JFYWNoKGVudHJ5ID0+IHsKICAgICAgY29uc3QgaWQgPSBlbnRyeS50YXJnZXQuZ2V0QXR0cmlidXRlKCdpZCcpOwogICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihgLm5hdi1saW5rcyBhW2hyZWY9IiMke2lkfSJdYCk7CiAgICAgIGlmIChlbnRyeS5pc0ludGVyc2VjdGluZykgewogICAgICAgIG5hdkxpbmtzLmZvckVhY2gobCA9PiBsLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpKTsKICAgICAgICBpZiAobGluaykgbGluay5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTsKICAgICAgfQogICAgfSk7CiAgfSwgeyB0aHJlc2hvbGQ6IDAuNSB9KTsKICBzZWN0aW9ucy5mb3JFYWNoKHNlY3Rpb24gPT4gc2VjdGlvbk9ic2VydmVyLm9ic2VydmUoc2VjdGlvbikpOwoKICBjb25zdCBiYWNrVG9Ub3AgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFjay10by10b3AnKTsKICBjb25zdCBwcm9ncmVzc0JhciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9ncmVzcy1iYXInKTsKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgKCkgPT4gewogICAgY29uc3Qgc2Nyb2xsVG9wID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcDsKICAgIGNvbnN0IHNjcm9sbEhlaWdodCA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQgLSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0OwogICAgY29uc3Qgc2Nyb2xsZWQgPSAoc2Nyb2xsVG9wIC8gc2Nyb2xsSGVpZ2h0KSAqIDEwMDsKICAgIHByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gYCR7c2Nyb2xsZWR9JWA7CiAgICBpZiAod2luZG93LnNjcm9sbFkgPiAzMDApIHsKICAgICAgYmFja1RvVG9wLmNsYXNzTGlzdC5hZGQoJ3Nob3cnKTsKICAgIH0gZWxzZSB7CiAgICAgIGJhY2tUb1RvcC5jbGFzc0xpc3QucmVtb3ZlKCdzaG93Jyk7CiAgICB9CiAgfSk7CiAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KCdzY3JvbGwnKSk7CiAgYmFja1RvVG9wLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgd2luZG93LnNjcm9sbFRvKHsgdG9wOiAwLCBiZWhhdmlvcjogJ3Ntb290aCcgfSk7CiAgfSk7CgogIGNvbnN0IGNvcHlyaWdodEljb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29weXJpZ2h0LWljb24nKTsKICBpZiAoY29weXJpZ2h0SWNvbikgewogICAgY29weXJpZ2h0SWNvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgY29weXJpZ2h0SWNvbi5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTsKICAgIH0pOwogIH0KCiAgc2VjdGlvbnMuZm9yRWFjaChzZWMgPT4gewogICAgc2VjLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbW92ZScsIGUgPT4gewogICAgICBjb25zdCByZWN0ID0gc2VjLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICBjb25zdCB4ID0gKChlLmNsaWVudFggLSByZWN0LmxlZnQpIC8gcmVjdC53aWR0aCAtIDAuNSkgKiAxMDsKICAgICAgY29uc3QgeSA9IC0oKGUuY2xpZW50WSAtIHJlY3QudG9wKSAvIHJlY3QuaGVpZ2h0IC0gMC41KSAqIDEwOwogICAgICBzZWMuc3R5bGUuc2V0UHJvcGVydHkoJy0tdGlsdFgnLCBgJHt4fWRlZ2ApOwogICAgICBzZWMuc3R5bGUuc2V0UHJvcGVydHkoJy0tdGlsdFknLCBgJHt5fWRlZ2ApOwogICAgfSk7CgogICAgc2VjLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoKSA9PiB7CiAgICAgIHNlYy5zdHlsZS5zZXRQcm9wZXJ0eSgnLS10aWx0WCcsICcwZGVnJyk7CiAgICAgIHNlYy5zdHlsZS5zZXRQcm9wZXJ0eSgnLS10aWx0WScsICcwZGVnJyk7CiAgICB9KTsKICB9KTsKCiAgaW5pdENvZGVCYWNrZ3JvdW5kKCk7Cn0pOwoKZnVuY3Rpb24gcG9wdWxhdGUoZGF0YSkgewogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYW1lJykudGV4dENvbnRlbnQgPSBkYXRhLm5hbWU7CiAgY29uc3QgaGVhZGxpbmVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFkbGluZScpOwogIGNvbnN0IHN1bW1hcnlFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdW1tYXJ5Jyk7CiAgdHlwZVdyaXRlcihkYXRhLmhlYWRsaW5lLCBoZWFkbGluZUVsLCAwLCAoKSA9PiB7CiAgICBoZWFkbGluZUVsLmNsYXNzTGlzdC5yZW1vdmUoJ3RhZ2xpbmUnKTsKICAgIHN1bW1hcnlFbC5jbGFzc0xpc3QuYWRkKCd0YWdsaW5lJyk7CiAgICB0eXBlV3JpdGVyKAogICAgICBkYXRhLnN1bW1hcnksCiAgICAgIHN1bW1hcnlFbCwKICAgICAgMCwKICAgICAgKCkgPT4gc3VtbWFyeUVsLmNsYXNzTGlzdC5yZW1vdmUoJ3RhZ2xpbmUnKSwKICAgICAgNTAKICAgICk7CiAgfSwgNTApOwoKICBjb25zdCBjb250YWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbnRhY3QtY29udGVudCcpOwogIGNvbnRhY3QudGV4dENvbnRlbnQgPSAnJzsKCiAgY29uc3QgcGhvbmVQID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpOwogIGNvbnN0IHBob25lTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICBjb25zdCBzYWZlUGhvbmUgPSBzYW5pdGl6ZVBob25lKGRhdGEuY29udGFjdC5waG9uZSk7CiAgcGhvbmVMaW5rLmhyZWYgPSBgdGVsOiR7c2FmZVBob25lfWA7CiAgcGhvbmVMaW5rLmNsYXNzTmFtZSA9ICdjb250YWN0LWxpbmsnOwogIHBob25lTGluay5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnUGhvbmUnKTsKICBjb25zdCBwaG9uZUljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7CiAgcGhvbmVJY29uLmNsYXNzTmFtZSA9ICdmYS1zb2xpZCBmYS1waG9uZSc7CiAgcGhvbmVMaW5rLmFwcGVuZENoaWxkKHBob25lSWNvbik7CiAgcGhvbmVMaW5rLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRhdGEuY29udGFjdC5waG9uZSkpOwogIHBob25lUC5hcHBlbmRDaGlsZChwaG9uZUxpbmspOwogIGNvbnN0IHBob25lQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgcGhvbmVCdG4uY2xhc3NOYW1lID0gJ2NvcHktYnRuJzsKICBwaG9uZUJ0bi5zZXRBdHRyaWJ1dGUoJ2RhdGEtY29weScsIHNhZmVQaG9uZSk7CiAgcGhvbmVCdG4uc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgJ0NvcHkgcGhvbmUnKTsKICBjb25zdCBwaG9uZUJ0bkljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7CiAgcGhvbmVCdG5JY29uLmNsYXNzTmFtZSA9ICdmYS1zb2xpZCBmYS1jb3B5JzsKICBwaG9uZUJ0bi5hcHBlbmRDaGlsZChwaG9uZUJ0bkljb24pOwogIHBob25lUC5hcHBlbmRDaGlsZChwaG9uZUJ0bik7CiAgY29udGFjdC5hcHBlbmRDaGlsZChwaG9uZVApOwoKICBjb25zdCBlbWFpbFAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7CiAgY29uc3QgZW1haWxMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogIGNvbnN0IHNhZmVFbWFpbCA9IHNhbml0aXplRW1haWwoZGF0YS5jb250YWN0LmVtYWlsKTsKICBlbWFpbExpbmsuaHJlZiA9IGBtYWlsdG86JHtzYWZlRW1haWx9YDsKICBlbWFpbExpbmsuY2xhc3NOYW1lID0gJ2NvbnRhY3QtbGluayc7CiAgZW1haWxMaW5rLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdFbWFpbCcpOwogIGNvbnN0IGVtYWlsSWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTsKICBlbWFpbEljb24uY2xhc3NOYW1lID0gJ2ZhLXNvbGlkIGZhLWVudmVsb3BlJzsKICBlbWFpbExpbmsuYXBwZW5kQ2hpbGQoZW1haWxJY29uKTsKICBlbWFpbExpbmsuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoc2FmZUVtYWlsKSk7CiAgZW1haWxQLmFwcGVuZENoaWxkKGVtYWlsTGluayk7CiAgY29uc3QgZW1haWxCdG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICBlbWFpbEJ0bi5jbGFzc05hbWUgPSAnY29weS1idG4nOwogIGVtYWlsQnRuLnNldEF0dHJpYnV0ZSgnZGF0YS1jb3B5Jywgc2FmZUVtYWlsKTsKICBlbWFpbEJ0bi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCAnQ29weSBlbWFpbCcpOwogIGNvbnN0IGVtYWlsQnRuSWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTsKICBlbWFpbEJ0bkljb24uY2xhc3NOYW1lID0gJ2ZhLXNvbGlkIGZhLWNvcHknOwogIGVtYWlsQnRuLmFwcGVuZENoaWxkKGVtYWlsQnRuSWNvbik7CiAgZW1haWxQLmFwcGVuZENoaWxkKGVtYWlsQnRuKTsKICBjb250YWN0LmFwcGVuZENoaWxkKGVtYWlsUCk7CgogIGNvbnN0IGxvY1AgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7CiAgY29uc3QgbG9jTGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICBsb2NMaW5rLmhyZWYgPSBgaHR0cHM6Ly9tYXBzLmdvb2dsZS5jb20vP3E9JHtlbmNvZGVVUklDb21wb25lbnQoZGF0YS5jb250YWN0LmxvY2F0aW9uKX1gOwogIGxvY0xpbmsuY2xhc3NOYW1lID0gJ2NvbnRhY3QtbGluayc7CiAgbG9jTGluay50YXJnZXQgPSAnX2JsYW5rJzsKICBsb2NMaW5rLnJlbCA9ICdub29wZW5lciBub3JlZmVycmVyJzsKICBsb2NMaW5rLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsICdMb2NhdGlvbicpOwogIGNvbnN0IGxvY0ljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7CiAgbG9jSWNvbi5jbGFzc05hbWUgPSAnZmEtc29saWQgZmEtbG9jYXRpb24tZG90JzsKICBsb2NMaW5rLmFwcGVuZENoaWxkKGxvY0ljb24pOwogIGxvY0xpbmsuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGF0YS5jb250YWN0LmxvY2F0aW9uKSk7CiAgbG9jUC5hcHBlbmRDaGlsZChsb2NMaW5rKTsKICBjb250YWN0LmFwcGVuZENoaWxkKGxvY1ApOwoKICBkYXRhLmNvbnRhY3QucHJvZmlsZXMuZm9yRWFjaChwID0+IHsKICAgIGNvbnN0IHNhZmVVcmwgPSBzYW5pdGl6ZVVybChwLnVybCk7CiAgICBpZiAoIXNhZmVVcmwpIHJldHVybjsKICAgIGNvbnN0IHBFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsKICAgIGNvbnN0IGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICBhLmhyZWYgPSBzYWZlVXJsOwogICAgYS5jbGFzc05hbWUgPSAnY29udGFjdC1saW5rJzsKICAgIGEudGFyZ2V0ID0gJ19ibGFuayc7CiAgICBhLnJlbCA9ICdub29wZW5lciBub3JlZmVycmVyJzsKICAgIGEuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgcC5zaXRlKTsKICAgIGNvbnN0IGljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7CiAgICBjb25zdCBpY29uQ2xhc3MgPSBwcm9maWxlSWNvbnNbcC5zaXRlXSB8fCAnZmEtc29saWQgZmEtbGluayc7CiAgICBpY29uLmNsYXNzTmFtZSA9IGljb25DbGFzczsKICAgIGEuYXBwZW5kQ2hpbGQoaWNvbik7CiAgICBhLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHAuc2l0ZSkpOwogICAgcEVsLmFwcGVuZENoaWxkKGEpOwogICAgY29udGFjdC5hcHBlbmRDaGlsZChwRWwpOwogIH0pOwoKICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jb3B5LWJ0bicpLmZvckVhY2goYnRuID0+IHsKICAgICAgYnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIGNvbnN0IHZhbHVlID0gYnRuLmdldEF0dHJpYnV0ZSgnZGF0YS1jb3B5Jyk7CiAgICAgICAgY29uc3QgaWNvbiA9IGJ0bi5xdWVyeVNlbGVjdG9yKCdpJyk7CiAgICAgICAgY29uc3Qgb3JpZ2luYWwgPSBpY29uLmNsYXNzTmFtZTsKICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dCh2YWx1ZSkudGhlbigoKSA9PiB7CiAgICAgICAgICBpY29uLmNsYXNzTmFtZSA9ICdmYS1zb2xpZCBmYS1jaGVjayc7CiAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgICAgaWNvbi5jbGFzc05hbWUgPSBvcmlnaW5hbDsKICAgICAgICAgIH0sIDIwMDApOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwoKICAgIGlmIChjb250YWN0LmNsYXNzTGlzdC5jb250YWlucygnb3BlbicpKSB7CiAgICAgIGNvbnRhY3Quc3R5bGUubWF4SGVpZ2h0ID0gY29udGFjdC5zY3JvbGxIZWlnaHQgKyAncHgnOwogICAgfQoKICBjb25zdCBza2lsbHMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2tpbGxzLWxpc3QnKTsKICBkYXRhLnNraWxscy5mb3JFYWNoKHMgPT4gewogICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOwogICAgY29uc3QgaWNvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTsKICAgIGljb24uY2xhc3NOYW1lID0gZ2V0U2tpbGxJY29uKHMpOwogICAgbGkuYXBwZW5kQ2hpbGQoaWNvbik7CiAgICBsaS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShgICR7c31gKSk7CiAgICBza2lsbHMuYXBwZW5kQ2hpbGQobGkpOwogIH0pOwoKICBjb25zdCBsYW5ndWFnZXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbGFuZ3VhZ2VzLWxpc3QnKTsKICBkYXRhLmxhbmd1YWdlcy5mb3JFYWNoKGxhbmcgPT4gewogICAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpOwogICAgbGkudGV4dENvbnRlbnQgPSBgJHtsYW5nLmxhbmd1YWdlfSAoJHtsYW5nLnByb2ZpY2llbmN5fSlgOwogICAgbGFuZ3VhZ2VzLmFwcGVuZENoaWxkKGxpKTsKICB9KTsKCiAgY29uc3QgZWR1ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VkdWNhdGlvbi1jb250ZW50Jyk7CiAgZGF0YS5lZHVjYXRpb24uZm9yRWFjaChpdGVtID0+IHsKICAgIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgZGl2LmNsYXNzTGlzdC5hZGQoJ2VudHJ5Jyk7CgogICAgY29uc3QgaDMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMycpOwogICAgY29uc3QgZ3JhZEljb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7CiAgICBncmFkSWNvbi5jbGFzc05hbWUgPSAnZmEtc29saWQgZmEtZ3JhZHVhdGlvbi1jYXAnOwogICAgaDMuYXBwZW5kQ2hpbGQoZ3JhZEljb24pOwogICAgaDMuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoYCAke2l0ZW0uZGVncmVlfWApKTsKICAgIGRpdi5hcHBlbmRDaGlsZChoMyk7CgogICAgY29uc3QgcGVyaW9kUCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsKICAgIHBlcmlvZFAudGV4dENvbnRlbnQgPSBgJHtpdGVtLmluc3RpdHV0aW9ufSAoJHtpdGVtLnN0YXJ0X2RhdGV9IOKAkyAke2l0ZW0uZW5kX2RhdGV9KWA7CiAgICBkaXYuYXBwZW5kQ2hpbGQocGVyaW9kUCk7CgogICAgaWYgKGl0ZW0uZ3BhKSB7CiAgICAgIGNvbnN0IGdwYVAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7CiAgICAgIGdwYVAudGV4dENvbnRlbnQgPSBgR1BBOiAke2l0ZW0uZ3BhfWA7CiAgICAgIGRpdi5hcHBlbmRDaGlsZChncGFQKTsKICAgIH0KCiAgICBpZiAoaXRlbS5ub3RlcyAmJiBpdGVtLm5vdGVzLmxlbmd0aCkgewogICAgICBjb25zdCB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7CiAgICAgIGl0ZW0ubm90ZXMuZm9yRWFjaChuID0+IHsKICAgICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICAgICAgbGkudGV4dENvbnRlbnQgPSBuOwogICAgICAgIHVsLmFwcGVuZENoaWxkKGxpKTsKICAgICAgfSk7CiAgICAgIGRpdi5hcHBlbmRDaGlsZCh1bCk7CiAgICB9CiAgICBlZHUuYXBwZW5kQ2hpbGQoZGl2KTsKICB9KTsKCiAgY29uc3QgZXhwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2V4cGVyaWVuY2UtY29udGVudCcpOwogIGRhdGEud29ya19leHBlcmllbmNlLmZvckVhY2goam9iID0+IHsKICAgIGlmIChqb2Iucm9sZXMpIHsKICAgICAgam9iLnJvbGVzLmZvckVhY2gocm9sZSA9PiBleHAuYXBwZW5kQ2hpbGQoYnVpbGRKb2Iocm9sZSwgam9iLmNvbXBhbnkpKSk7CiAgICB9IGVsc2UgewogICAgICBleHAuYXBwZW5kQ2hpbGQoYnVpbGRKb2Ioam9iLCBqb2IuY29tcGFueSkpOwogICAgfQogIH0pOwoKICBjb25zdCBwcm9qZWN0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcm9qZWN0cy1jb250ZW50Jyk7CiAgT2JqZWN0LmVudHJpZXMoZGF0YS5wcm9qZWN0cykuZm9yRWFjaCgoW2NhdCwgaXRlbXNdKSA9PiB7CiAgICBjb25zdCBoMyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gzJyk7CiAgICBoMy50ZXh0Q29udGVudCA9IHRpdGxlQ2FzZShjYXQucmVwbGFjZSgvXy9nLCAnICcpKTsKICAgIHByb2plY3RzLmFwcGVuZENoaWxkKGgzKTsKICAgIGNvbnN0IHVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKTsKICAgIGl0ZW1zLmZvckVhY2goaXQgPT4gewogICAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICAgIGxpLnRleHRDb250ZW50ID0gaXQ7CiAgICAgIHVsLmFwcGVuZENoaWxkKGxpKTsKICAgIH0pOwogICAgcHJvamVjdHMuYXBwZW5kQ2hpbGQodWwpOwogIH0pOwoKICBjb25zdCBwdWJsaWNhdGlvbnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHVibGljYXRpb25zLWxpc3QnKTsKICBkYXRhLnB1YmxpY2F0aW9ucy5mb3JFYWNoKHB1YiA9PiB7CiAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICBjb25zdCBzdHJvbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHJvbmcnKTsKICAgIHN0cm9uZy50ZXh0Q29udGVudCA9IHB1Yi50aXRsZTsKICAgIGxpLmFwcGVuZENoaWxkKHN0cm9uZyk7CiAgICBsaS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgnLCAnKSk7CiAgICBjb25zdCBlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2VtJyk7CiAgICBlbS50ZXh0Q29udGVudCA9IHB1Yi52ZW51ZTsKICAgIGxpLmFwcGVuZENoaWxkKGVtKTsKICAgIGxpLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGAgKCR7cHViLmRhdGV9KWApKTsKICAgIHB1YmxpY2F0aW9ucy5hcHBlbmRDaGlsZChsaSk7CiAgfSk7CgogIGNvbnN0IGNlcnRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NlcnRpZmljYXRpb25zLWxpc3QnKTsKICBkYXRhLmNlcnRpZmljYXRpb25zX3RyYWluaW5nLmZvckVhY2goYyA9PiB7CiAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICBsaS50ZXh0Q29udGVudCA9IGM7CiAgICBjZXJ0cy5hcHBlbmRDaGlsZChsaSk7CiAgfSk7CgogIGNvbnN0IGFjaGlldmVtZW50cyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhY2hpZXZlbWVudHMtbGlzdCcpOwogIGRhdGEuYWNoaWV2ZW1lbnRzLmZvckVhY2goYSA9PiB7CiAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICBsaS50ZXh0Q29udGVudCA9IGE7CiAgICBhY2hpZXZlbWVudHMuYXBwZW5kQ2hpbGQobGkpOwogIH0pOwp9CgpmdW5jdGlvbiBidWlsZEpvYihyb2xlLCBjb21wYW55KSB7CiAgY29uc3QgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgZGl2LmNsYXNzTGlzdC5hZGQoJ2VudHJ5Jyk7CgogIGNvbnN0IGgzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDMnKTsKICBjb25zdCBpY29uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpOwogIGljb24uY2xhc3NOYW1lID0gZ2V0Um9sZUljb24ocm9sZS50aXRsZSk7CiAgaDMuYXBwZW5kQ2hpbGQoaWNvbik7CiAgaDMuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoYCAke3JvbGUudGl0bGV9IOKAlCAke2NvbXBhbnl9YCkpOwogIGRpdi5hcHBlbmRDaGlsZChoMyk7CgogIGNvbnN0IHBlcmlvZFAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7CiAgcGVyaW9kUC5jbGFzc0xpc3QuYWRkKCdwZXJpb2QnKTsKICBwZXJpb2RQLnRleHRDb250ZW50ID0gZm9ybWF0UGVyaW9kKHJvbGUuc3RhcnRfZGF0ZSwgcm9sZS5lbmRfZGF0ZSk7CiAgZGl2LmFwcGVuZENoaWxkKHBlcmlvZFApOwoKICBjb25zdCB1bCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3VsJyk7CiAgcm9sZS5oaWdobGlnaHRzLmZvckVhY2goaCA9PiB7CiAgICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7CiAgICBsaS50ZXh0Q29udGVudCA9IGg7CiAgICB1bC5hcHBlbmRDaGlsZChsaSk7CiAgfSk7CiAgZGl2LmFwcGVuZENoaWxkKHVsKTsKICByZXR1cm4gZGl2Owp9CgpmdW5jdGlvbiBmb3JtYXRQZXJpb2Qoc3RhcnQsIGVuZCkgewogIGNvbnN0IGZvcm1hdHRlZEVuZCA9IGVuZCAmJiBlbmQudG9Mb3dlckNhc2UoKSAhPT0gJ3ByZXNlbnQnID8gZW5kIDogJ1ByZXNlbnQnOwogIHJldHVybiBgJHtzdGFydH0g4oCTICR7Zm9ybWF0dGVkRW5kfWA7Cn0KCmZ1bmN0aW9uIHRpdGxlQ2FzZShzdHIpIHsKICByZXR1cm4gc3RyLnJlcGxhY2UoL1x3Ky9nLCB3ID0+IHdbMF0udG9VcHBlckNhc2UoKSArIHcuc2xpY2UoMSkpOwp9CgpmdW5jdGlvbiB0eXBlV3JpdGVyKHRleHQsIGVsLCBpID0gMCwgZG9uZSwgc3BlZWQgPSAxMDApIHsKICBpZiAoaSA8IHRleHQubGVuZ3RoKSB7CiAgICBlbC50ZXh0Q29udGVudCArPSB0ZXh0LmNoYXJBdChpKTsKICAgIHNldFRpbWVvdXQoKCkgPT4gdHlwZVdyaXRlcih0ZXh0LCBlbCwgaSArIDEsIGRvbmUsIHNwZWVkKSwgc3BlZWQpOwogIH0gZWxzZSBpZiAodHlwZW9mIGRvbmUgPT09ICdmdW5jdGlvbicpIHsKICAgIGRvbmUoKTsKICB9Cn0KCmZ1bmN0aW9uIGluaXRNYXRyaXgoaWQpIHsKICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7CiAgaWYgKCFjYW52YXMpIHJldHVybjsKICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICBjb25zdCBmb250U2l6ZSA9IDEwOwogIGxldCBjb2x1bW5zID0gMDsKICBsZXQgZHJvcHMgPSBbXTsKICBjb25zdCBsZXR0ZXJzID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaJy5yZXBlYXQoNikuc3BsaXQoJycpOwoKICBmdW5jdGlvbiByZXNpemUoKSB7CiAgICBjYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwogICAgY2FudmFzLndpZHRoID0gY2FudmFzLm9mZnNldFdpZHRoOwogICAgY29sdW1ucyA9IE1hdGguZmxvb3IoY2FudmFzLndpZHRoIC8gZm9udFNpemUpOwogICAgZHJvcHMgPSBuZXcgQXJyYXkoY29sdW1ucykuZmlsbCgxKTsKICAgIGN0eC5mb250ID0gZm9udFNpemUgKyAncHggbW9ub3NwYWNlJzsKICB9CgogIGZ1bmN0aW9uIGRyYXcoKSB7CiAgICBjdHguZmlsbFN0eWxlID0gJ3JnYmEoMCwgMCwgMCwgMC4xKSc7CiAgICBjdHguZmlsbFJlY3QoMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZHJvcHMubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgdGV4dCA9IGxldHRlcnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogbGV0dGVycy5sZW5ndGgpXTsKICAgICAgY3R4LmZpbGxTdHlsZSA9ICcjMGYwJzsKICAgICAgY3R4LmZpbGxUZXh0KHRleHQsIGkgKiBmb250U2l6ZSwgZHJvcHNbaV0gKiBmb250U2l6ZSk7CiAgICAgIGRyb3BzW2ldKys7CiAgICAgIGlmIChkcm9wc1tpXSAqIGZvbnRTaXplID4gY2FudmFzLmhlaWdodCAmJiBNYXRoLnJhbmRvbSgpID4gMC45NSkgewogICAgICAgIGRyb3BzW2ldID0gMDsKICAgICAgfQogICAgfQogIH0KCiAgcmVzaXplKCk7CiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHJlc2l6ZSk7CiAgc2V0SW50ZXJ2YWwoZHJhdywgMzMpOwp9CgpmdW5jdGlvbiBpbml0Q29kZUJhY2tncm91bmQoKSB7CiAgY29uc3Qgc25pcHBldHMgPSBbCiAgICAnY29uc3QgeCA9IDQyOycsCiAgICAnY29uc29sZS5sb2coIkhlbGxvLCB3b3JsZCEiKTsnLAogICAgJ2ZvciAobGV0IGkgPSAwOyBpIDwgMTA7IGkrKykgeyB9JywKICAgICdpZiAodmFsdWUpIHtcbiAgZG9Tb21ldGhpbmcoKTtcbn0nLAogICAgJ2xldCBzdW0gPSAoYSwgYikgPT4gYSArIGI7JwogIF07CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNlY3Rpb24nKS5mb3JFYWNoKHNlY3Rpb24gPT4gewogICAgY29uc3QgYmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGJnLmNsYXNzTmFtZSA9ICdjb2RlLWJnJzsKICAgIHNlY3Rpb24uYXBwZW5kQ2hpbGQoYmcpOwoKICAgIGZ1bmN0aW9uIGN5Y2xlKCkgewogICAgICBjb25zdCBzbmlwcGV0ID0gc25pcHBldHNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc25pcHBldHMubGVuZ3RoKV07CiAgICAgIGJnLnRleHRDb250ZW50ID0gJyc7CiAgICAgIGJnLnN0eWxlLm9wYWNpdHkgPSAwLjI7CiAgICAgIGJnLnN0eWxlLnRvcCA9IGAke01hdGgucmFuZG9tKCkgKiA4MCArIDEwfSVgOwogICAgICBiZy5zdHlsZS5sZWZ0ID0gYCR7TWF0aC5yYW5kb20oKSAqIDgwICsgMTB9JWA7CiAgICAgIHR5cGVXcml0ZXIoc25pcHBldCwgYmcsIDAsICgpID0+IHsKICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICAgIGJnLnN0eWxlLm9wYWNpdHkgPSAwOwogICAgICAgICAgc2V0VGltZW91dChjeWNsZSwgMTAwMCk7CiAgICAgICAgfSwgMjAwMCk7CiAgICAgIH0pOwogICAgfQoKICAgIGN5Y2xlKCk7CiAgfSk7Cn0K'));
